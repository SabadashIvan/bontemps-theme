{% comment %} 
This module will build a bundle of three items, displayed in a row. the submit button will make an ajax call to add the three items to the cart.

This module is dependant on the cart.js package being installed on the theme -
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shopify-cartjs/0.4.1/cart.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shopify-cartjs/0.4.1/rivets-cart.min.js"></script>

 and instantiated using this script:
 <script type="text/javascript">
    jQuery(function() {
        CartJS.init({{ cart | json }});
    });
</script>
{% endcomment %}

<script>
    var product_text_1 = $('#selected_product_1');
    var product_text_2 = $('#selected_product_2');
    var product_text_3 = $('#selected_product_3');
    console.log(product_text_1)
</script>

{% capture logic_script %}
<script>
    var product_id_1;
    var product_id_2;
    var product_id_3;
    var id_array = [];
    function addProduct(id, title){
        console.log(id, title, product_text_1);
        var title = title;
        if ($('#selected_product_1').text() == '' ){
            $('#selected_product_1').text(title);
            product_id_1 = id;
        } else if ($('#selected_product_2').text() == ''){
            $('#selected_product_2').text(title);
            product_id_2 = id;
        } else {
            $('#selected_product_3').text(title);
            product_id_3 = id;
        }
    };
    function removeProduct(loc){
        if (loc == '1'){
            $('#selected_product_1').text('');
            product_id_1 = null;
        } else if (loc == '2'){
            $('#selected_product_2').text('');
            product_id_2 = null;
        } else if (loc == '3'){
            $('#selected_product_3').text('');
            product_id_3 = null;
        }
    };
    function bundle() {
        id_array = [];
        if (product_id_1 != undefined && product_id_1 != null){
            id_array.push(product_id_1);
        }
        if (product_id_2 != undefined && product_id_2 != null){
            id_array.push(product_id_2);
        }
        if (product_id_3 != undefined && product_id_3 != null){
            id_array.push(product_id_3);
        }
        console.log(id_array);
        if(id_array.length == 3 ){
        for (i = 0; i < id_array.length; i++){
            CartJS.addItem(id_array[i], 1, properties=null,options={
                "complete": function() {
                    console.log('complete!');
                },
                "success": function(data, textStatus, jqXHR){
                    console.log('success')
                }
            })
        }
        } else {
            alert("Please add more items to your bundle");
        }
    };
    $(document).on('cart.requestComplete', function(event, cart) {
        console.log("Request complete");
    });
</script>

{% endcapture %}


<!-- TODO config this page and schema -->
{% layout 'theme' %}
{% section 'header-bundles' %}
<div class="contained">
<div class="row text-center" style="margin: 2em 0;">
<div class="col-12 text-center">
<h1>Make It A Threesome</h1>
<p>Select Three Blends for Free Shipping</p>
<h2>$29.95</h2>
<p>60 tea sachets</p>
</div>
    <div class="col-4">
    <h3 id="selected_product_1"></h3>
    <h4>Tea One</h4>
    <a type="button" id="remove_1" onClick="removeProduct('1')">Remove</a>
    </div>
    <div class="col-4">
    <h3 id="selected_product_2"></h3>
    <h4>Tea Two</h4>
    <a type="button" id="remove_2" onClick="removeProduct('2')">Remove</a>
    </div>
    <div class="col-4">
    <h3 id="selected_product_3"></h3>
    <h4>Tea Three</h4>
    <a type="button" id="remove_3" onClick="removeProduct('3')">Remove</a>
    </div>
</div>
<div class="row" style="margin: 2em 0;">
    {% for product in collections.all.products %}
    <div class="col-4" style="margin-bottom: 2em; padding: 1em;">
    <h2>{{product.title}}</h2>
    <p>{{product.id}}</p>
    <a  type="button" class="btn btn-small" onClick="addProduct('{{ product.selected_or_first_available_variant.id }}', '{{product.title | escape }}');" id="bundle_adder_{{ product.id }}">Add to Bundle</a>
    </div>
    {% endfor %}
</div>
<a type="button" onClick="bundle()">Add Bundle to Cart</a>
</div>
    {{ logic_script }}
